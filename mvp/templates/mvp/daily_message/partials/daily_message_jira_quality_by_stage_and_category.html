<div>
  <h2 style="font-weight: bold">By Stage</h2>
  <hr style="margin-top: 10px; margin-bottom: 20px"/>
  <table style="width: 100%; border-collapse: collapse; table-layout: fixed">
    <thead>
      <tr>
        <th style="background-color: #f5f5f5; text-align: left; border-bottom: 1px solid #f5f5f5; padding: 10px">Stage</th>
        <th style="background-color: #f5f5f5; text-align: center; border-bottom: 1px solid #f5f5f5; padding: 10px">Ticket Count</th>
        <th style="background-color: #f5f5f5; text-align: center; border-bottom: 1px solid #f5f5f5; padding: 10px">Avg Score</th>
        <th style="background-color: #f5f5f5; text-align: right; border-bottom: 1px solid #f5f5f5; padding: 10px">Category</th>
      </tr>
    </thead>
    <tbody>
      {% for item in by_stage %}
        <tr>
          <td style="text-align: left; border-bottom: 1px solid #f5f5f5; padding: 10px">{{ item.stage }}</td>
          <td style="text-align: center; border-bottom: 1px solid #f5f5f5; padding: 10px">{{ item.ticket_count }}</td>
            {% if item.score %}
                <td style="text-align: center; border-bottom: 1px solid #f5f5f5; padding: 10px">{{ item.score|floatformat:0 }}</td>
            {% else %}
                <td style="text-align: center; border-bottom: 1px solid #f5f5f5; padding: 10px">{{ item.average_count|floatformat:0 }}</td>
            {% endif %}
          <td style="text-align: right; border-bottom: 1px solid #f5f5f5; padding: 10px">
            {% include "mvp/daily_message/partials/daily_message_jira_quality_category.html" with quality_category=item.quality_category only %}
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
  <h2 style="font-weight: bold; margin-top: 30px">By Category</h2>
  <hr style="margin-top: 10px; margin-bottom: 20px"/>
  <table style="width: 100%; border-collapse: collapse; table-layout: fixed">
    <thead>
      <tr>
        <th style="background-color: #f5f5f5; text-align: left; border-bottom: 1px solid #f5f5f5; padding: 10px">Category</th>
        <th style="background-color: #f5f5f5; text-align: center; border-bottom: 1px solid #f5f5f5; padding: 10px">Ticket Count</th>
        <th style="background-color: #f5f5f5; text-align: center; border-bottom: 1px solid #f5f5f5; padding: 10px">Avg Score</th>
        <th style="background-color: #f5f5f5; text-align: right; border-bottom: 1px solid #f5f5f5; padding: 10px">Category</th>
      </tr>
    </thead>
    <tbody>
      {% for item in by_category %}
        <tr>
          <td style="text-align: left; border-bottom: 1px solid #f5f5f5; padding: 10px">{{ item.category }}</td>
          <td style="text-align: center; border-bottom: 1px solid #f5f5f5; padding: 10px">{{ item.ticket_count }}</td>
            {% if item.score %}
                <td style="text-align: center; border-bottom: 1px solid #f5f5f5; padding: 10px">{{ item.score|floatformat:0 }}</td>
            {% else %}
                <td style="text-align: center; border-bottom: 1px solid #f5f5f5; padding: 10px">{{ item.average_count|floatformat:0 }}</td>
            {% endif %}
          <td style="text-align: right; border-bottom: 1px solid #f5f5f5; padding: 10px">
            {% include "mvp/daily_message/partials/daily_message_jira_quality_category.html" with quality_category=item.quality_category only %}
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
